<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>INDUSTREER – Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial, sans-serif; background:#f4f6f8; margin:0; padding:20px; }
    h1 { margin-bottom: 20px; }
    .box { background:#fff; padding:20px; margin-bottom:20px; border-radius:8px; box-shadow:0 2px 4px rgba(0,0,0,0.1); }
    button { padding:10px 14px; cursor:pointer; margin-top:10px; }
    .result { margin-top:10px; font-weight:bold; white-space:pre-line; }
    .small { color:#666; font-size:0.95em; }
  </style>
</head>
<body>

<h1>INDUSTREER – Adminbereich</h1>

<div class="box">
  <h2>Mitarbeiter importieren (CSV)</h2>
  <div class="small">Spalten: employee_id, name, language</div>
  <input type="file" id="empCsv" accept=".csv">
  <br>
  <button onclick="importCsv('/api/import/employees', 'empCsv', 'empResult')">Importieren</button>
  <div class="result" id="empResult"></div>
</div>

<div class="box">
  <h2>Projekte importieren (CSV)</h2>
  <div class="small">Spalten: project_id, name</div>
  <input type="file" id="projCsv" accept=".csv">
  <br>
  <button onclick="importCsv('/api/import/projects', 'projCsv', 'projResult')">Importieren</button>
  <div class="result" id="projResult"></div>
</div>

<div class="box">
  <h2>Tageszuordnung importieren (CSV)</h2>
  <div class="small">
    Spalten: employee_id, project_id, work_date, approved<br>
    Datum: 17.12.2025 <b>oder</b> 2025-12-17 | Trennzeichen ; oder ,
  </div>
  <input type="file" id="dayCsv" accept=".csv">
  <br>
  <button onclick="importCsv('/api/import/day-projects', 'dayCsv', 'dayResult')">Importieren</button>
  <div class="result" id="dayResult"></div>
</div>

<div class="box">
  <h2>Terminal</h2>
  <div class="small">Öffne das Terminal für die Mitarbeiter:</div>
  <p><a href="/terminal.html">/terminal.html öffnen</a></p>
</div>

<script>
async function importCsv(url, inputId, resultId) {
  const input = document.getElementById(inputId);
  const result = document.getElementById(resultId);
  result.innerText = "";

  if (!input.files.length) {
    alert("Bitte CSV-Datei auswählen");
    return;
  }

  try {
    result.innerText = "⏳ Import läuft ...";
    const csvText = await input.files[0].text();

    const res = await fetch(url, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ csv: csvText })
    });

    const text = await res.text();
    let data;
    try { data = JSON.parse(text); }
    catch { throw new Error("Server-Antwort ist kein JSON:\n" + text.slice(0,200)); }

    if (!res.ok || !data.ok) {
      throw new Error(data.error || "Unbekannter Serverfehler");
    }

    const parts = [];
    if (typeof data.imported === "number") parts.push("✅ Importiert: " + data.imported);
    if (typeof data.skipped === "number") parts.push("⚠ Übersprungen: " + data.skipped);
    if (typeof data.errors === "number") parts.push("❌ Fehler: " + data.errors);

    result.innerText = parts.join("\n") || "✅ OK";
  } catch (err) {
    console.error(err);
    result.innerText = "❌ Fehler beim Import";
    alert("Fehler beim Import: " + err.message);
  }
}
</script>

</body>
</html>
